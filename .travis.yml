install:
  - curl -O http://static.rust-lang.org/dist/rust-nightly-x86_64-unknown-linux-gnu.tar.gz
  - tar xf rust-nightly-x86_64-unknown-linux-gnu.tar.gz
  - sudo ./rust-nightly-x86_64-unknown-linux-gnu/install.sh

  - curl -O http://static.rust-lang.org/cargo-dist/cargo-nightly-linux.tar.gz
  - tar xf cargo-nightly-linux.tar.gz
  - sudo ./cargo-nightly/install.sh

script:
  - cargo build
  - cargo test
  - ./doc.sh
  - ./doc.sh --test

after_success: |
  [ $TRAVIS_BRANCH = master ] &&
  [ $TRAVIS_PULL_REQUEST = false ] &&
  echo '<meta http-equiv=refresh content=0;url=url/index.html>' > doc/index.html &&
  sudo pip install ghp-import &&
  ghp-import -n doc &&
  git push -fq https://${TOKEN}@github.com/${TRAVIS_REPO_SLUG}.git gh-pages

env:
  - secure: DoxnyDvhhRocCKtvyRe0Wa4P/zwhEcSH67kSa1f+KMuLzZQqIxFqCGTha2KzKyuymMMVyUC1Is+MWzVjBtAaIHCm07Do/TH9rWijTZx0pWK9bJ8idxzycGTsZJEyzDQbkpGNRsAfygxwP2r+K6VSE6MDg2M6AjnSLzpjWMLqr+s=
